<!doctype html>

<html lang="en"></html>
<head>
  <meta charset="utf-8">

  <title>Ornstein dataset - sigd3h.default plot</title>
  <script src="https://d3js.org/d3-selection.v1.min.js"></script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
  <script>
    let data = [{"x":53.875,"y":"BNK","xlow":44.8912,"xup":62.8588,"obs":2,"g1":1,"g2":0,"g3":1,"g4":1,"g5":1,"g6":1,"g7":1,"g8":1,"g9":1,"g10":1},{"x":25.99,"y":"FIN","xlow":20.505,"xup":31.475,"obs":4,"g1":1,"g2":1,"g3":1,"g4":0,"g5":1,"g6":1,"g7":1,"g8":0,"g9":0,"g10":0},{"x":22.9217,"y":"TRN","xlow":16.7467,"xup":29.0966,"obs":9,"g1":1,"g2":1,"g3":1,"g4":0,"g5":0,"g6":1,"g7":1,"g8":0,"g9":0,"g10":0},{"x":20.7568,"y":"WOD","xlow":14.6396,"xup":26.8739,"obs":10,"g1":1,"g2":1,"g3":1,"g4":0,"g5":0,"g6":1,"g7":0,"g8":0,"g9":0,"g10":0},{"x":19.321,"y":"MIN","xlow":14.6722,"xup":23.9697,"obs":8,"g1":1,"g2":1,"g3":0,"g4":0,"g5":0,"g6":1,"g7":0,"g8":0,"g9":0,"g10":0},{"x":13.7876,"y":"HLD","xlow":4.1676,"xup":23.4075,"obs":5,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":0,"g9":0,"g10":0},{"x":13.5295,"y":"MER","xlow":7.6888,"xup":19.3702,"obs":7,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":0,"g9":1,"g10":0},{"x":13.2795,"y":"MAN","xlow":8.7773,"xup":17.7817,"obs":6,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":1,"g9":1,"g10":1},{"x":11.938,"y":"AGR","xlow":7.9134,"xup":15.9625,"obs":1,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":1,"g9":1,"g10":1},{"x":7.3639,"y":"CON","xlow":-4.4872,"xup":19.215,"obs":3,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":0,"g9":1,"g10":1}];
  </script>

  <script>
    // Variables
    let height = 500, width = 500;
      margin = {top: height * 0.02, left: width * 0.15, bottom: height * 0.2, right: width * 0.05},
      adjustedWidth = width - margin.left - margin.right,
      adjustedHeight = height - margin.top - margin.bottom,
      colors = ["purple", "lightgray", "black"],
      pointSize = [3.5,2], lineSize = [2, 1],
      labelFontFamily = "sans-serif", xLabel = "Effect of Sector",
      labelFont = 14, axesFont = 12;

    // Append svg to the body
    let svg = d3.select("body")
      .append("svg")
        .attr("width", adjustedWidth + margin.left + margin.right)
        .attr("height", adjustedHeight + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Mapping functions
    const xMap = (el) => x(el.x);
    const xlMap = (el) => x(el.xlow);
    const xuMap = (el) => x(el.xup);
    const yMap = (el) => y(el.y);

    // Axes initialization
    let rgY = [0];
    const deltaY = adjustedHeight/(data.length-1);
    for(let i = 1; i < data.length; i++) {
      rgY.push(i * deltaY);
    }

    let y = d3.scaleOrdinal()
      .domain(Array.from(data, el => el.y))
      .range(rgY);

    let x = d3.scaleLinear()
      .domain([d3.min(data, (el) => el.xlow), d3.max(data, (el) => el.xup)])
      .range([0, adjustedWidth]);

    svg.append("g")
      .attr("transform", "translate(0," + adjustedHeight * 1.025 + ")")
      .call(d3.axisBottom(x).tickSizeOuter(0));

    svg.append("g")
      .attr("transform", `translate(${-adjustedWidth * 0.035},0)`)
      .call(d3.axisLeft(y));

    d3.selectAll(".tick").style("font-size", `${axesFont}px`)

    // Mouseover highlight function
    const highlight = (d) => {
      for (let i = 0; i < data.length; i++){
        if (data[i][`g${d.obs}`] === 1){
          d3.selectAll(`circle[cy="${yMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("fill", colors[0])
           .attr("r", pointSize[0])

          d3.selectAll(`line[y1="${yMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("stroke", colors[0])
           .attr("stroke-width", lineSize[0])
        } else {
          d3.selectAll(`circle[cy="${yMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("fill", colors[1])
           .attr("r", pointSize[1])

          d3.selectAll(`line[y1="${yMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("stroke", colors[1])
           .attr("stroke-width", lineSize[1])
        }
      }
    }

    // Mouseleave highlight function
    const doNotHighlight = () => {
      d3.selectAll(".dot")
       .transition()
       .duration(200)
       .style("fill", colors[2])
       .attr("r", pointSize[1])

      d3.selectAll(".line")
       .transition()
       .duration(200)
       .style("stroke", colors[2])
       .attr("stroke-width", lineSize[1])
    }

    // Horizontal label
    svg.append("text")
      .attr("y", adjustedHeight + margin.bottom*0.4)
      .attr("x", adjustedWidth / 2)
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .style("font-size", `${labelFont}px`)
      .text(xLabel)
      .style("font-family", labelFontFamily);

    // Graph dot lines
    for (let i = 0; i < data.length; i++) {
      svg.append("line")
        .attr("class", "line")
        .attr("x1", xlMap(data[i]))
        .attr("y1", yMap(data[i]))
        .attr("x2", xuMap(data[i]))
        .attr("y2", yMap(data[i]))
        .attr("stroke", colors[2])
        .attr("stroke-width", lineSize[1])
    }

    // Graph points
    svg.selectAll(".dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("class", "dot")
        .attr("r", pointSize[1])
        .attr("cx", xMap)
        .attr("cy", yMap)
      .on("mouseover", highlight)
      .on("mouseleave", doNotHighlight )
</script>
</body>
