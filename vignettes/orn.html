<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Ornstein dataset - sigd3.default plot</title>
  <script src="https://d3js.org/d3-selection.v1.min.js"></script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>
<body>
  <script>
    let data = [{"x":"BNK","y":53.875,"ylow":44.8912,"yup":62.8588,"obs":2,"g1":1,"g2":0,"g3":1,"g4":1,"g5":1,"g6":1,"g7":1,"g8":1,"g9":1,"g10":1},{"x":"FIN","y":25.99,"ylow":20.505,"yup":31.475,"obs":4,"g1":1,"g2":1,"g3":1,"g4":0,"g5":1,"g6":1,"g7":1,"g8":0,"g9":0,"g10":0},{"x":"TRN","y":22.9217,"ylow":16.7467,"yup":29.0966,"obs":9,"g1":1,"g2":1,"g3":1,"g4":0,"g5":0,"g6":1,"g7":1,"g8":0,"g9":0,"g10":0},{"x":"WOD","y":20.7568,"ylow":14.6396,"yup":26.8739,"obs":10,"g1":1,"g2":1,"g3":1,"g4":0,"g5":0,"g6":1,"g7":0,"g8":0,"g9":0,"g10":0},{"x":"MIN","y":19.321,"ylow":14.6722,"yup":23.9697,"obs":8,"g1":1,"g2":1,"g3":0,"g4":0,"g5":0,"g6":1,"g7":0,"g8":0,"g9":0,"g10":0},{"x":"HLD","y":13.7876,"ylow":4.1676,"yup":23.4075,"obs":5,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":0,"g9":0,"g10":0},{"x":"MER","y":13.5295,"ylow":7.6888,"yup":19.3702,"obs":7,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":0,"g9":1,"g10":0},{"x":"MAN","y":13.2795,"ylow":8.7773,"yup":17.7817,"obs":6,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":1,"g9":1,"g10":1},{"x":"AGR","y":11.938,"ylow":7.9134,"yup":15.9625,"obs":1,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":1,"g9":1,"g10":1},{"x":"CON","y":7.3639,"ylow":-4.4872,"yup":19.215,"obs":3,"g1":0,"g2":1,"g3":0,"g4":1,"g5":0,"g6":0,"g7":0,"g8":0,"g9":1,"g10":1}];
  </script>

  <script>
    // Variables
    let height = 500, width = 900,
      margin = {top: height * 0.02, right: width * 0.15, bottom: height * 0.15, left: width * 0.1},
      adjustedWidth = width - margin.left - margin.right,
      adjustedHeight = height - margin.top - margin.bottom,
      colors = ["purple", "lightgray", "black"],
      pointSize = [7, 5], lineSize = [3, 1.5],
      labelFontFamily = "sans-serif", yLabel = "Effect of Region",
      labelFont = 14, axesFont = 12;

    // Append svg to the body
    let svg = d3.select("body")
      .append("svg")
        .attr("width", adjustedWidth + margin.left + margin.right)
        .attr("height", adjustedHeight + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Mapping functions
    const xMap = (el) => x(el.x);
    const yMap = (el) => y(el.y);
    const ylMap = (el) => y(el.ylow);
    const yuMap = (el) => y(el.yup);

    // Axes initialization
    let rgX = [0];
    const deltaX = adjustedWidth / (data.length - 1)
    for (let i = 1; i < data.length; i++) {
      rgX.push(i * deltaX);
    }

    const x = d3.scaleOrdinal()
      .domain(Array.from(data, el => el.x))
      .range(rgX);

    const y = d3.scaleLinear()
      .domain([d3.min(data, (el) => el.ylow), d3.max(data, (el) => el.yup)])
      .range([adjustedHeight, 0]);

    svg.append("g")
      .attr("transform", "translate(0," + adjustedHeight * 1.075 + ")")
      .call(d3.axisBottom(x));

    svg.append("g")
      .attr("transform", `translate(${-adjustedWidth * .035},0)`)
      .call(d3.axisLeft(y));

    d3.selectAll(".tick").style("font-size", `${axesFont}px`)

    // Mouseover highlight function
    const highlight = (d) => {
      for(let i = 0; i < data.length; i++) {
        if (data[i][`g${d.obs}`] === 1) {
          d3.selectAll(`circle[cx="${xMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("fill", colors[0])
           .attr("r", pointSize[0])

          d3.select(`line[x1="${xMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("stroke", colors[0])
           .attr("stroke-width", lineSize[0])
        } else {
          d3.selectAll(`circle[cx="${xMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("fill", colors[1])
           .attr("r", pointSize[1])

          d3.select(`line[x1="${xMap(data[i])}"]`)
           .transition()
           .duration(50)
           .style("stroke", colors[1])
           .attr("stroke-width", lineSize[1])
        }
      }
    }

    // Mouseleave highlight function
    const doNotHighlight = () => {
      d3.selectAll(".dot")
        .transition()
        .duration(200)
        .style("fill", colors[2])
        .attr("r",pointSize[1])

      d3.selectAll(".line")
        .transition()
        .duration(200)
        .style("stroke", colors[2])
        .attr("stroke-width",lineSize[1])
    }

    // Vertical label
    svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left)
      .attr("x", 0 - (adjustedHeight / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .style("font-size", `${labelFont}px`)
      .text(yLabel)
      .style("font-family", labelFontFamily);

    // Graph dot lines
    for (let i = 0; i < data.length; i++){
      svg.append("line")
        .attr("class", "line")
        .attr("x1", xMap(data[i]))
        .attr("y1", ylMap(data[i]))
        .attr("x2", xMap(data[i]))
        .attr("y2", yuMap(data[i]))
        .attr("stroke", colors[2])
        .attr("stroke-width", lineSize[1])
    }

    // Graph points
    svg.selectAll(".dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("class", "dot")
        .attr("r", pointSize[1])
        .attr("cx", xMap)
        .attr("cy", yMap)
      .on("mouseover", highlight)
      .on("mouseleave", doNotHighlight )

    </script>
  </body>
